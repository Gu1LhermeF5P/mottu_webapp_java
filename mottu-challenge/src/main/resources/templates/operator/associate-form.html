<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/header :: head('Trocar Dispositivo')}"></head>

<body data-theme="emerald">
    <div th:replace="~{fragments/header :: navbar}"></div>

    <main class="container mx-auto p-4 lg:p-8">
        <h1 class="text-3xl font-bold mb-6">Troca / Manutenção de Dispositivo</h1>

        <div th:if="${successMessage}" role="alert" class="alert alert-success mb-4" th:text="${successMessage}"></div>
        <div th:if="${errorMessage}" role="alert" class="alert alert-error mb-4" th:text="${errorMessage}"></div>

        <div class="max-w-2xl mx-auto card bg-base-100 shadow-xl">
            <div class="card-body">
                <p class="text-sm mb-4">Selecione uma moto para ver seu dispositivo atual e escolha um novo dispositivo do estoque para realizar a troca.</p>
                <form th:action="@{/operator/associate}" method="post">
                    <div class="form-control">
                        <label class="label"><span class="label-text">1. Selecione a Moto</span></label>
                        <select name="motorcycleId" class="select select-bordered w-full" required>
                            <option disabled selected value="">Escolha uma moto</option>
                            <option th:each="moto : ${motorcycles}" th:value="${moto.id}"
                                    th:text="${moto.licensePlate} + ' - ' + ${moto.model} + ' (Dispositivo Atual: ' + (${moto.trackingDevice != null ? moto.trackingDevice.uuid.substring(0, 8) + '...' : 'Nenhum'}) + ')'">
                            </option>
                        </select>
                    </div>

                    <div class="form-control mt-4">
                        <label class="label"><span class="label-text">2. Selecione o NOVO Dispositivo (do estoque)</span></label>
                        <select name="trackingDeviceId" class="select select-bordered w-full" required>
                            <option disabled selected value="">Escolha um novo dispositivo</option>
                            <option th:each="device : ${trackingDevices}" th:value="${device.id}" th:text="${device.uuid}"></option>
                        </select>
                         <div th:if="${trackingDevices.isEmpty()}" class="text-warning text-sm mt-2">Nenhum dispositivo disponível no estoque.</div>
                    </div>

                    <div class="card-actions justify-end mt-8">
                        <button type="submit" class="btn btn-primary" th:disabled="${trackingDevices.isEmpty()}">Confirmar Troca</button>
                    </div>
                </form>
            </div>
        </div>
    </main>
</body>
</html>